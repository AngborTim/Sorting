<!DOCTYPE HTML>
<html lang="en">
<HTML>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="css/4.6.1_bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <link href="pics/favicon.ico" rel="icon">
  
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.js"></script>
    

    <title>Sorting</title>
</head>

<body>


<h1>Sorting</h1>

<div class="container justify-content-center"> 

  <table class="table">
    <tr id="numbers">
    </tr>
    <tr id="buffer">
    </tr>
  </table>
<input id="btn_sort" type="button" class="btn btn-outline-primary" value="Merge sort">
</div>

</body>

<script>
let count = 20;

let numbers_array = Array.from(Array(count).keys());

$(document).ready(function() {
  shuffle(Object.assign([],numbers_array));
  new_numbers();
  $("#btn_sort").on('click', ()=>{
    //loop_with_delay(numbers_array);
    bubble(numbers_array);
    //sort(numbers_array,0,numbers_array.length-1,"0"); //Object.assign([],numbers_array)
  })
});


function shuffle(n_array){
  // пока длинна временного массива больше 1
  if (n_array.length-1>1){
    // получаем случайное число от 1 до последнего индекса массива цифр
    let z = Math.floor(Math.random()*(n_array.length-1))
    // меняем местами цифры между последней позицией и позицией z
    n_array[z] = numbers_array[n_array.length-1]
    numbers_array[n_array.length-1] = numbers_array[z];
    numbers_array[z] = n_array[z];
    // убираем последнюю позицию из временного массива
    n_array.pop();
    // передаем в рекурсию
    shuffle(n_array);
  }
  else{
    // если временный массив - одна цифра, выходим из рекурсии
    return 0;
  }
}


let c = 0;
let delay = 1000;


function loop_with_delay(n_array){
  setTimeout(function(){
    let flag = false;
    if (n_array[c] > n_array[c+1] && c+1 < n_array.length) {
        flag = true;
        let tmp = n_array[c];
        n_array[c] = n_array[c+1];
        change_cell("n"+c, n_array[c+1], c);
        n_array[c+1] = tmp;
        change_cell("n"+(c+1), tmp, c);
      }
    if (flag){
      loop_with_delay(n_array);
    }
    else{
      return 0
    }
    c++;
    if (c < n_array.length){
      loop_with_delay(n_array);
    }
  }, delay)
}



function bubble(n_array){
  let flag = false;
  for (let a = 0; a<n_array.length; a++){
    if (n_array[a] > n_array[a+1] && a+1 < n_array.length) {
      flag = true;
      let tmp = n_array[a];
      n_array[a] = n_array[a+1];
      change_cell("n"+a, n_array[a+1], a);
      n_array[a+1] = tmp;
      change_cell("n"+(a+1), tmp, a);
    }
  }
  if (flag){
    bubble(n_array);
  }
  else{
    return 0
  }
}


function change_cell(index, value, delay){
  $("#"+index).text(value)
}


function sort(n_array, start_point, end_point, branch){

  //alert("branch: "+branch +"\r\n"+ " <"+ n_array+ ">"+"\r\n" +" start pos: " + (start_point+1) +" end pos: "+ (end_point+1))

  // if (start_point < end_point){
  //   let middle = Math.floor((start_point + end_point)/2);
  //   //alert(x);
  //   let left_n_arr = Object.assign([],n_array).slice(0, middle);
  //   sort(left_n_arr , 0, middle, "left" );
  //   //alert("out")  
  //   let right_n_arr =Object.assign([],n_array).slice(middle);
  //   sort(right_n_arr= n_array.slice(middle+1, end_point) , middle+1, end_point, "right" );
    
  // }
  // else {
  //   aaa +=' : '+ n_array[0];
  //   c++;
  //   return n_array;
  // }  
}



function new_numbers(){
  for (let i = 0; i<count; i++){
    let a = $("<td class='cell border' id='n"+i+"'></td>").text(numbers_array[i]);
    $("#numbers").append(a);
    $("#buffer").append("<td class='cell border' id='b"+i+"'></td>");
  }
}


</script>

</HTML>